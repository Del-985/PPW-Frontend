<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
</head>
<body>
  <header class="container">
    <h1>Pioneer Admin Dashboard</h1>
    <nav>
      <a href="index.html">Home</a>
      <button onclick="logout()">Logout</button>
    </nav>
  </header>

  <h2>Contact Submissions</h2>
  <table id="contacts-table">
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>Email</th><th>Message</th><th>Submitted At</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Business Users</h2>
  <table id="business-users-table">
    <thead>
      <tr><th>ID</th><th>Name</th><th>Email</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // Load Contacts
    async function loadContacts() {
      try {
        const res = await fetch('https://pioneer-pressure-washing.onrender.com/api/admin/contacts', {
          credentials: 'include'
        });
        const data = await res.json();
        const tbody = document.querySelector('#contacts-table tbody');
        tbody.innerHTML = '';
        data.forEach(c => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${c.id}</td><td>${c.name}</td><td>${c.email}</td>
            <td>${c.message}</td><td>${new Date(c.submitted_at).toLocaleString()}</td>
            <td><span class="btn-delete" onclick="deleteContact(${c.id})">üóëÔ∏è</span></td>
          `;
          tbody.appendChild(row);
        });
      } catch (err) {
        alert('Failed to load contacts.');
      }
    }

    // Load Business Users
    async function loadBusinessUsers() {
      try {
        const res = await fetch('https://pioneer-pressure-washing.onrender.com/api/admin/business-users', {
          credentials: 'include'
        });
        const data = await res.json();
        const tbody = document.querySelector('#business-users-table tbody');
        tbody.innerHTML = '';
        data.forEach(u => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${u.id}</td><td>${u.business_name}</td><td>${u.email}</td>
            <td><span class="btn-delete" onclick="deleteBusinessUser(${u.id})">üóëÔ∏è</span></td>
          `;
          tbody.appendChild(row);
        });
      } catch (err) {
        alert('Failed to load business users.');
      }
    }

    async function deleteContact(id) {
      if (!confirm('Are you sure you want to delete this contact?')) return;
      await fetch(`https://pioneer-pressure-washing.onrender.com/api/admin/contact/${id}`, {
        method: 'DELETE',
        credentials: 'include'
      });
      loadContacts();
    }

    async function deleteBusinessUser(id) {
      if (!confirm('Are you sure you want to delete this user?')) return;
      await fetch(`https://pioneer-pressure-washing.onrender.com/api/admin/business-user/${id}`, {
        method: 'DELETE',
        credentials: 'include'
      });
      loadBusinessUsers();
    }

    function logout() {
      document.cookie = "token=; path=/; max-age=0;";
      window.location.href = "admin-login.html";
    }

    // Init
    loadContacts();
    loadBusinessUsers();
  </script>
</body>
</html>
